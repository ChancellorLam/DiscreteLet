<div class="unit-test-container">
 
  <!-- Difficulty Selection Screen -->
  <div *ngIf="!testStarted() && !testCompleted()" class="difficulty-selection">
    <p-card>
      <ng-template pTemplate="header">
        <div class="test-header">
          <h2>{{ config.title }}</h2>
          <p>{{ config.description }}</p>
        </div>
      </ng-template>


      <div class="difficulty-options">
        <h3>Select Test Difficulty:</h3>
       
        <div class="difficulty-cards">
          <p-card
            [ngClass]="{'selected': selectedDifficulty() === 'easy'}"
            (click)="selectDifficulty('easy')"
            class="difficulty-card easy-card">
            <div class="difficulty-content">
              <i class="pi pi-check-circle"></i>
              <h4>Easy Test</h4>
              <p>Fundamental concepts and basic problems</p>
              <p class="question-count">
                {{ getQuestionCountByDifficulty('easy') }} questions</p>
            </div>
          </p-card>


          <p-card
            [ngClass]="{'selected': selectedDifficulty() === 'hard'}"
            (click)="selectDifficulty('hard')"
            class="difficulty-card hard-card">
            <div class="difficulty-content">
              <i class="pi pi-bolt"></i>
              <h4>Hard Test</h4>
              <p>Advanced concepts and challenging problems</p>
              <p class="question-count">
                {{ getQuestionCountByDifficulty('hard') }} questions</p>
            </div>
          </p-card>
        </div>


        <div class="test-info" *ngIf="selectedDifficulty()">
          <p><strong>Passing Score:</strong> {{ config.passingScore }}%</p>
          <p *ngIf="config.timeLimit">
            <strong>Time Limit:</strong> {{ config.timeLimit }} minutes
          </p>
        </div>


        <p-button
          label="Start Test"
          icon="pi pi-play"
          (onClick)="startTest()"
          [disabled]="!selectedDifficulty()"
          styleClass="p-button-lg start-button">
        </p-button>
      </div>
    </p-card>
  </div>


  <!-- Test Questions Screen -->
  <div *ngIf="testStarted() && !testCompleted()" class="test-content">
    <p-card>
      <ng-template pTemplate="header">
        <div class="test-progress">
          <div class="progress-info">
            <span class="difficulty-badge" [ngClass]="selectedDifficulty()">
              {{ selectedDifficulty()?.toUpperCase() }}
            </span>
            <span>Question {{ currentQuestionIndex() + 1 }} of {{ testQuestions().length }}</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="getProgress()"></div>
          </div>
        </div>
      </ng-template>


      <div class="question-section">
        <h3>{{ getCurrentQuestion()?.question }}</h3>


        <div class="options-list">
          <div
            *ngFor="let option of getCurrentQuestion()?.options; let i = index"
            class="option-item"
            [ngClass]="{'selected': currentAnswer === i}">
            <p-radioButton
              [value]="i"
              [(ngModel)]="currentAnswer"
              [inputId]="'option-' + i"
              name="answer">
            </p-radioButton>
            <label [for]="'option-' + i">{{ option }}</label>
          </div>
        </div>
      </div>


      <ng-template pTemplate="footer">
        <div class="test-actions">
          <p-button
            label="Previous"
            icon="pi pi-chevron-left"
            (onClick)="previousQuestion()"
            [disabled]="currentQuestionIndex() === 0"
            styleClass="p-button-secondary">
          </p-button>


          <p-button
            *ngIf="currentQuestionIndex() < testQuestions().length - 1"
            label="Next"
            icon="pi pi-chevron-right"
            iconPos="right"
            (onClick)="nextQuestion()"
            [disabled]="currentAnswer === null">
          </p-button>


          <p-button
            *ngIf="currentQuestionIndex() === testQuestions().length - 1"
            label="Submit Test"
            icon="pi pi-check"
            (onClick)="completeTest()"
            [disabled]="currentAnswer === null"
            styleClass="p-button-success">
          </p-button>
        </div>
      </ng-template>
    </p-card>
  </div>


  <!-- Results Screen -->
  <div *ngIf="testCompleted() && showResults()" class="test-results">
    <p-card>
      <ng-template pTemplate="header">
        <div class="results-header" [ngClass]="{'passed': hasPassed(), 'failed': !hasPassed()}">
          <i [class]="hasPassed() ? 'pi pi-check-circle' : 'pi pi-times-circle'"></i>
          <h2>{{ hasPassed() ? 'Congratulations!' : 'Test Complete' }}</h2>
        </div>
      </ng-template>


      <div class="results-content">
        <div class="score-display">
          <div class="score-circle" [ngClass]="{'passed': hasPassed(), 'failed': !hasPassed()}">
            <span class="score-number">{{ getScorePercentage() }}%</span>
            <span class="score-label">Score</span>
          </div>
        </div>


        <div class="score-details">
          <p>
            <strong>Questions Correct:</strong>
            {{ score() }} / {{ testQuestions().length }}
          </p>
          <p>
            <strong>Difficulty:</strong>
            <span class="difficulty-badge" [ngClass]="selectedDifficulty()">
              {{ selectedDifficulty()?.toUpperCase() }}
            </span>
          </p>
          <p>
            <strong>Passing Score:</strong>
            {{ config.passingScore }}%
          </p>
        </div>


        <p-divider></p-divider>


        <div class="result-message">
          <p-message
            *ngIf="hasPassed()"
            severity="success"
            text="You passed! Great job understanding the material!">
          </p-message>
          <p-message
            *ngIf="!hasPassed()"
            severity="warn"
            text="You didn't pass this time. Review the material and try again!">
          </p-message>
        </div>


        <!-- Question Review -->
        <div class="question-review">
          <h4>Review Your Answers:</h4>
          <div *ngFor="let question of testQuestions(); let i = index" class="review-item">
            <div class="review-header">
              <span class="question-number">Q{{ i + 1 }}</span>
              <i
                [class]="selectedAnswers()[i] === question.correctAnswer ? 'pi pi-check correct' : 'pi pi-times incorrect'">
              </i>
            </div>
            <p class="review-question">{{ question.question }}</p>
            <p class="review-answer">
              <strong>Your answer:</strong>
              {{ question.options[selectedAnswers()[i]] || 'Not answered' }}
            </p>
            <p class="review-correct" *ngIf="selectedAnswers()[i] !== question.correctAnswer">
              <strong>Correct answer:</strong>
              {{ question.options[question.correctAnswer] }}
            </p>
            <p class="review-explanation" *ngIf="question.explanation">
              <strong>Explanation:</strong> {{ question.explanation }}
            </p>
          </div>
        </div>
      </div>


      <ng-template pTemplate="footer">
        <div class="results-actions">
          <p-button
            label="Retake Test"
            icon="pi pi-refresh"
            (onClick)="retakeTest()"
            styleClass="p-button-primary">
          </p-button>
        </div>
      </ng-template>
    </p-card>
  </div>


</div>

